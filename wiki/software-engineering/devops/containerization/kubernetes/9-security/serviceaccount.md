In Kubernetes there are 2 types of accounts:

-   User accounts used by users like admins and developers
-   Service Accounts used by applications. Example:
    -   Jenkins uses a service account to deploy applications on the Kubernetes cluster. In this case, Jenkins needs to communicate with the Kubernetes API wherefore authentication is necessary - applications can authenticate with ServiceAccounts
    -   For every namespace in Kubernetes, there is a default ServiceAccount which has permissions to run basic Kubernetes API queries
    -   Roles can be assigned to ServiceAccounts to allow role-based access mechanism

## Authentication and token generation

### In Kubernetes version < 1.22

If a service account is created Kubernetes automatically creates a service account token (bearer token) which must be used by the external application while authenticating to Kubernetes API

-   A non-expiring token is stored in a Secret object which is linked to the Service Account
    -   Run **`$ kubectl describe secret <name>`** to see the Bearer token
-   The token is valid until ServiceAccount is deleted
-   If no custom ServiceAccount is specified, the default service account and its token is used and will be automatically mounted to that pod as a volume mount

#### Still using Secrets in newer version

If you would still like to create Secrets the old way with non-expiring token, then you could still do that:

1. Create a ServiceAccount
2. Create a Secret manually and link it to the Service Account by setting the [Secret type](../configuration/secrets.md#types) to `kubernetes.io/service-account-token` and the name of the service account specified within annotations

```yaml
apiVersion: v1
kind: Secret
metadata:
    name: my-secrets
    annotations: kubernetes.io/service-account.name: my-service-acc
type: kubernetes.io/service-account-token
data:
    USERNAME: !udefd     # Values are Base64 encoded
    PASSWORD: dqwfqf     # Values are Base64 encoded
```

### In Kubernetes version 1.22

The Token will no longer be stored in automatically created Secrets because of Security concerns. Instead Tokens with a defined lifetime are generated by a TokenRequestAPI when the Pod is created and this token is then mounted as a volume into the pod.

### In Kubernetes version 1.24

A token is no longer generated automatically when creating a ServiceAccount. The token must be created: **`$ kubectl create token <name>`**

## Use custom ServiceAccounts

Editing a ServiceAccount for Pods require to delete and re-create Pods. In case of deployments, ServiceAccount can be changed as the Deployment will take care of the recreation.

```
apiVersion: v1
kind: Pod
metadata:
    name: myapp-pod
spec:
  containers:
    - name: nginx-container
      image: nginx
  serviceAccountName: my-service-acc
```

## Commands

<table data-header-hidden><thead><tr><th width="224"></th><th></th></tr></thead><tbody><tr><td>Create ServiceAccount</td><td><strong><code>$ kubectl create serviceaccount &#x3C;name></code></strong></td></tr><tr><td>Delete Pod</td><td><strong><code>$ kubectl delete serviceaccount &#x3C;name></code></strong></td></tr><tr><td>Show all ServiceAccounts</td><td><strong><code>$ kubectl get serviceaccount</code></strong></td></tr><tr><td>Show details of Pods</td><td><strong><code>$ kubectl describe serviceaccounts &#x3C;name></code></strong></td></tr></tbody></table>
